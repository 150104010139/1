日月 光华   - -   Internet 精华区 文章 阅读 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
   发信人 :   srcap   ( 垃圾 ) ,   信 区 :   Internet 
 标     题 :   《   软件 中 的 插件 技术   》 
 发信站 :   日月 光华 站   ( Fri   Apr   30   11 : 59 : 30   1999 )   ,   转信 
 
 插件 概述 
 
 　 　 插件 的 本质 是 在 不 修改 程序 主体 的 情况 下 对 软件 功能 进行 加强 ， 当 插件 的 接口 
 被 公开 时 ， 任何 公司 或 个人 都 可以 自己 制作 插件 来 解决 一些 操作 上 的 不便 或 增加 一 
 些 功能 。 比如 我 手头 正在 写 的 最新 版本 ENCounter ， 允许 其他 的 软件 接驳 进来 ， 驻 
 留 的 程序 可以 只是 ENCounter 一个 ， 但是 当 联网 成功 时 ， ENCounter 可以 除了 记费 
 外 ， 还 能 呼叫 其他 的 插件 模块 来 执行 诸如 检查 邮件 等 操作 ， 这样 比 驻留 一个 
 ENCounter 邮件 检查 软件 更 有效 。 
 　 　 使用 插件 的 软件 中 最 成功 的 莫过于 PhotoShop 了 。 使用 过 PhotoShop 的 人 对 滤 
 镜 一定 不 陌生 。 即使 是 初涉 图形 制作 的 生手 ， 只要 去 获取 一些 好 的 滤镜 ， 也 能够 轻 
 易地 作出 特殊效果 。 另 一套 著名 的 使用 插件 机制 的 软件 是 WinAmp ， WinAmp 早期 的 
 成功 虽然 在于 其 快速 的 解码 引擎 ， 但 在 MP3 播放器 中 能够 保持 长久 的 霸主 地位 ， 也 
 正是 由于 内置 了 健全 的 Skin 和 PlugIn ( 插件 ) 。 细心 的 朋友 一定 注意 到 了 ， 后期 的 
 WinAmp 中 增加 的 MIDI 、 MOD 、 WAVE 等 音乐格式 的 播放 功能 完全 是 靠 插件 实现 的 。 
 　 　 插件 还 可以 支持 多人 合作开发 ， 只要 有 一个 好 的 插件 机制 ， 不同 的 功能 可以 由 
 不同 的 人来 完成 ， 而且 由于 不同 插件 之间 互不 影响 ， 方便 程序 的 调试 和 纠错 。 
 
 插件 类型 
 
 　 　 从 广义 的 范围 来看 ， 插件 有 以下 三种 类型 ： 
 　 　 1 ．   类似 批 命令 的 简单 插件 。 事实上 这种 插件 的 自由度 非常低 。 使用 这种 方法 
 的 软件 有 Win   Hacker 等 ， 运行 这种 插件 后 ， 会 一步步 要求 用户 进行 选择 / 输入 ， 最 
 后 根据 用户 的 输入 来 执行 一系列 事先 定义 好 的 操作 。 这种 插件 一般 是 文本文件 。 功 
 能 比较 单一 ， 可扩展性 极小 。 优点 是 插件 做 起来 非常 方便 ， 即使 是 对 程序设计 了解 
 不多 的 人 也 可以 制作 。 如 WinAmp 的 Skin 。 
 　 　 2 ．   使用 一种 特殊 的 脚本语言 来 实现 的 插件 ( 暂时 称为 脚本 插件 ) 。 这种 插件 比 
 较 难 写 ， 需要 软件 开发者 自己 制作 一个 程序 解释 内核 。 比如 微软 惹 了 很多 麻烦 的 宏 
 就是 这种 类型 的 。 有 一套 著名 的 Office 辅助工具 就是 完全 用 Office 内置 的 
 VBScript 写成 的 。 这种 方法 的 优点 在于 无需 使用 其它 工具 来 制作 插件 ， 软件 本身 
 就 可以 实现 ， 普遍 出现 于 各种 办公自动化 软件 中 。 
 　 　 3 ．   利用 已有 的 程序开发 环境 来 制作 插件 。 例如 PhotoShop 等 软件 使用 的 方法 。 
 使用 这种 方法 的 软件 在 程序 主体 中 建立 了 多个 自定义 的 接口 ， 使 插件 能够 自由 访问 
 程序 中 的 各种 资源 。 这种 插件 的 优势 在于 自由度 极大 ， 可以 无限 发挥 插件 开发者 的 
 创意 ， 这种 插件 是 狭义 范围 的 插件 ， 也 是 真正 意义 上 的 插件 。 而 这种 插件 机制 的 编 
 写 相对 复杂 ， 对于 插件接口 之间 的 协调 比较 困难 ， 插件 的 开发 也 需要 专业 的 程序员 
 才能 进行 。 
 
 插件 实例 
 
 　 　 网页 作坊 （ HTML   SHOP ） 是 我国 第一个 使用 插件 机制 的 共享软件 。 
 　 　 以下 我们 将 以 HTML   SHOP 为 例子 ， 来 深入 了解 插件 机制 的 开发 ： 
 　 　 在 软件 中 添加 插件 机制 ， 首先 需要 进行 详细 的 应用 分析 ， 确定 应该 提供 哪些 资 
 源 给 插件 开发者 使用 。 HTML   SHOP 作为 一个 网页 编辑器 ， 对 网页 的 编辑 是 建立 在 “ 计 
 划 ” 的 基础 上 的 ， 因此 ， 我们 必须 提供 给 插件 开发者 访问 当前 打开 计划 信息 的 能力 ， 
 能够 自由 地 读取 和 写入 的 能力 。 
 　 　 为了 让 插件 提供 的 功能 能够 被 用户 方便 调用 ， 必须 将主 菜单 的 控制权 与 插件 开 
 发者 共享 ， 而 网页 作坊 的 程序界面 模仿 了 经典 软件开发 环境 Delphi   3.0 ， 因此 我 
 们 同时 将 工具条 中 的 标签 页 组 的 权利 提供 给 插件 开发者 。 这个 应用 分析 部分 是 插件 
 机制 开发 的 重头 ， 是 最难 把握 的 部分 ， 如果 提供 出来 的 权利 太 大 ， 写得 拙劣 的 插件 
 发生 错误 时 可能 威胁 到 主程序 ， 如果 提供 出来 的 权利 太小 ， 又 限制 了 插件 开发者 的 
 想象力 。 
 　 　 在 编程 方面 包括 了 两个 部分 ， 一部分 是 主体 程序 的 插件 处理 机制 ， 用来 进行 初 
 始化 每个 插件 的 过程 ， 并且 管理 好 每个 插件接口 ， 在 插件 访问 时 能够 做出 正确 的 反 
 馈 。 另 一部分 是 插件 的 接口函数 定义 ， 将 所有 的 插件接口 函数 进行 封装 ， 以便 开发 
 者 自由 调用 。 在 HTML   SHOP 中 ， 这部分 的 封装 文件 是 HBPlugin . pas ， 当 开发者 在 
 程序 中 引用 了 该 文件 时 ， 就 可以 直接 调用 其中 的 TOOLHOST 对象 ， 使用 封装 于 该 对 
 象 的 插件接口 函数 。 
 　 　 而 最 重要 的 部分 当然 是 插件 和 主程序 之间 的 通讯 了 。 在 网页 作坊 中 的 插件 其实 
 是 一个 遵循 了 某些 特定 规则 的 DLL ， 而 主程序 将 所有 插件接口 在 内存 中 的 地址 传递 
 给 插件 ， 插件 则 根据 这些 地址 来 呼叫 插件接口 完成 所 需 功能 、 获取 所 需 资源 等 。 
 
 
 
 - - 
   I   love : 
   games                             programming   
   and   that   others   consider   me   as   a   pile   of   garbage 
 
 ※   来源 : ・ 日月 光华 站   bbs . fudan . edu . cn ・ [ FROM :   10.13 . 21.21 ] 
 
   
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 [ 返回 上 一页 ]   [ 本 讨论区 ]